import{d as Z,E as tt,k as et,J as st,P as at,j as ot,H as nt,a as _,y as it,L as O,r as rt,o as v,c as g,b as t,e as x,f as r,I as k,t as i,c4 as lt,n as f,F as ct,g as dt,z as S,s as ut,p as ht}from"./index-61bbdb05.js";import{b as J}from"./route-block-83d24a4e.js";const pt={class:"#saved bg-customDark border rounded-lg grid sm:grid-cols-1 md:grid-cols-4 p-4 text-customGreen"},_t={class:"flex"},vt={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},mt=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20"},null,-1),gt={class:"font-bold"},ft={class:"text-xs"},bt={class:"flex"},xt={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},kt=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 #sav1"},null,-1),yt={class:"font-bold"},wt={class:"text-xs"},$t={class:"flex"},St={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},Ct=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-error"},null,-1),Nt={class:"font-bold"},jt={class:"text-xs"},It={class:"flex"},zt={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},Et=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-error"},null,-1),Lt={class:"font-bold"},Pt={class:"text-xs"},Vt={class:"flex items-center justify-between py-1"},Bt={class:"tabs tabs-boxed bg-transparent"},Dt={class:"text-lg font-semibold"},At={class:"#saved px-4 pt-3 pb-4 rounded shadow"},Tt={class:"overflow-x-auto"},Ft={class:"table staking-table w-full"},Ot={class:"bg-customDark border text-customGreen"},Jt={scope:"col",class:"uppercase",style:{width:"3rem",position:"relative"}},Rt={scope:"col",class:"uppercase"},Gt={scope:"col",class:"text-right uppercase"},Ht={scope:"col",class:"text-right uppercase"},Mt={scope:"col",class:"text-right uppercase"},Ut={class:"flex items-center overflow-hidden",style:{"max-width":"300px"}},Wt={class:"avatar mr-4 relative w-8 h-8 rounded-full"},qt=t("div",{class:"w-8 h-8 rounded-full bg-gray-400 absolute opacity-10"},null,-1),Kt={class:"w-8 h-8 rounded-full"},Qt=["src","onError"],Xt={class:"flex flex-col"},Yt={class:"text-sm #saved whitespace-nowrap overflow-hidden"},Zt={class:"text-xs"},te={class:"text-right"},ee={class:"flex flex-col"},se={class:"text-sm font-weight-medium whitespace-nowrap"},ae={class:"text-xs"},oe={class:"text-right text-xs"},ne={style:{display:"none"},class:"text-center"},ie={key:0,class:"badge badge-error gap-2 text-white"},re=["onClick"],le=t("div",{class:"divider"},null,-1),ce={class:"flex flex-row items-center"},de={class:"text-xs truncate relative py-2 px-4 rounded-md w-fit text-error mr-2"},ue=t("span",{class:"inset-x-0 inset-y-0 opacity-10 absolute bg-error"},null,-1),he={class:"text-xs truncate relative py-2 px-4 rounded-md w-fit text-warning"},pe=t("span",{class:"inset-x-0 inset-y-0 opacity-10 absolute bg-warning"},null,-1),_e={class:"text-xs hidden md:!block pl-2"},ve=Z({__name:"index",setup(me){const l=tt(),y=et(),u=st(),R=at(),j=ot(),G=nt(),H=JSON.parse(localStorage.getItem("avatars")||"{}"),m=_(H||{}),w=_({}),I=_({}),d=_("active"),b=_([]),C=_({});it(()=>{l.fetchUnbondingValdiators().then(e=>{b.value=e.concat(b.value)}),l.fetchInacitveValdiators().then(e=>{b.value=b.value.concat(e)}),j.rpc.getSlashingParams().then(e=>{C.value=e.params})});async function M(e=14400){var n,a,c;let s=0,o=Number(((c=(a=(n=y.latest)==null?void 0:n.block)==null?void 0:a.header)==null?void 0:c.height)||0);for(o>e?o-=e:o=1;s<l.validators.length&&o>0;)await y.fetchValidatorByHeight(o,s).then(h=>{h.validators.forEach(p=>{I.value[p.pub_key.key]=Number(p.voting_power)})}),s+=100;for(s=0;s<l.validators.length;)await y.fetchLatestValidators(s).then(h=>{h.validators.forEach(p=>{w.value[p.pub_key.key]=Number(p.voting_power)})}),s+=100}const U=O(()=>{const e={};return Object.keys(w.value).forEach(s=>{const o=w.value[s]||0,n=I.value[s]||0;e[s]=o-n}),e}),z=e=>{const s=e.consensus_pubkey.key,o=w.value[s];if(!o)return 0;const a=u.tokenAmountNumber({amount:parseInt(e.tokens,10).toString(),denom:l.params.bond_denom})/o;return U.value[s]*a},W=e=>{if(!e)return"";const s=z(e);return s&&s!==0?u.showChanges(s):""},q=e=>{if(!e)return"";const s=z(e);if(s>0)return"text-base-content";if(s<0)return"text-error"},K=function(e){var n;let s=0;for(let a=0;a<e;a++)s+=Number((n=l.validators[a])==null?void 0:n.delegator_shares);const o=s/l.totalPower;switch(!0){case(d.value==="active"&&o<.33):return"error";case(d.value==="active"&&o<.67):return"warning";default:return"primary"}};function Q(e,s){return!e||!s?!1:e.findIndex(o=>{var n,a,c;return s.website&&((a=s.website)==null?void 0:a.substring(0,(n=s.website)==null?void 0:n.lastIndexOf(".")).endsWith(o))||((c=s==null?void 0:s.moniker)==null?void 0:c.toLowerCase().search(o.toLowerCase()))>-1})>-1}const E=O(()=>{var e,s,o;if(d.value==="active")return l.validators.map((n,a)=>({v:n,rank:K(a),logo:N(n.description.identity)}));if(d.value==="featured"){const n=(o=(s=(e=j.current)==null?void 0:e.endpoints)==null?void 0:s.rest)==null?void 0:o.map(a=>a.provider);return n?(n.push("ping"),l.validators.filter(a=>Q(n,a.description)).map((a,c)=>({v:a,rank:"primary",logo:N(a.description.identity)}))):[]}return b.value.map((n,a)=>({v:n,rank:"primary",logo:N(n.description.identity)}))}),L=e=>new Promise(s=>{l.keybase(e).then(o=>{var n,a,c;if(Array.isArray(o.them)&&o.them.length>0){const h=String((c=(a=(n=o.them[0])==null?void 0:n.pictures)==null?void 0:a.primary)==null?void 0:c.url).replace("https://s3.amazonaws.com/keybase_processed_uploads/","");m.value[e]=h,s()}else throw new Error(`failed to fetch avatar for ${e}`)}).catch(o=>{s()})}),X=e=>{L(e).then(()=>{localStorage.setItem("avatars",JSON.stringify(m.value))})},Y=()=>{const e=l.validators.map(s=>{var n;const o=(n=s.description)==null?void 0:n.identity;return o&&!m.value[o]?L(o):Promise.resolve()});Promise.all(e).then(()=>localStorage.setItem("avatars",JSON.stringify(m.value)))},N=e=>{if(!e||!m.value[e])return"";const s=m.value[e]||"";return s.startsWith("http")?s:`https://s3.amazonaws.com/keybase_processed_uploads/${s}`},P=_(!1);return y.$subscribe((e,s)=>{if(s.recents.length>=2&&P.value===!1){P.value=!0;const o=Date.parse(s.recents[1].block.header.time)-Date.parse(s.recents[0].block.header.time),n=Number(s.recents[1].block.header.height)-Number(s.recents[0].block.header.height),a=Number(Number(86400*1e3*n/o).toFixed(0));M(a)}}),Y(),(e,s)=>{var n;const o=rt("RouterLink");return v(),g("div",null,[t("div",pt,[t("div",_t,[t("span",null,[t("div",vt,[x(r(k),{class:"text-base-content",icon:"mdi:trending-up",size:"32"}),mt])]),t("span",null,[t("div",gt,i(r(u).percent(r(G).inflation)),1),t("div",ft,i(e.$t("staking.inflation")),1)])]),t("div",bt,[t("span",null,[t("div",xt,[x(r(k),{class:"#saved",icon:"mdi:lock-open-outline",size:"32"}),kt])]),t("span",null,[t("div",yt,i(r(lt)((n=r(l).params)==null?void 0:n.unbonding_time)),1),t("div",wt,i(e.$t("staking.unbonding_time")),1)])]),t("div",$t,[t("span",null,[t("div",St,[x(r(k),{class:"text-error",icon:"mdi:alert-octagon-outline",size:"32"}),Ct])]),t("span",null,[t("div",Nt,i(r(u).percent(C.value.slash_fraction_double_sign)),1),t("div",jt,i(e.$t("staking.double_sign_slashing")),1)])]),t("div",It,[t("span",null,[t("div",zt,[x(r(k),{class:"text-error",icon:"mdi:pause",size:"32"}),Et])]),t("span",null,[t("div",Lt,i(r(u).percent(C.value.slash_fraction_downtime)),1),t("div",Pt,i(e.$t("staking.downtime_slashing")),1)])])]),t("div",null,[t("div",Vt,[t("div",Bt,[t("a",{class:f(["tab text-gray-400",{"tab-act":d.value==="featured"}]),onClick:s[0]||(s[0]=a=>d.value="featured")},i(e.$t("staking.popular")),3),t("a",{class:f(["tab text-gray-400",{"tab-act":d.value==="active"}]),onClick:s[1]||(s[1]=a=>d.value="active")},i(e.$t("staking.active")),3),t("a",{class:f(["tab text-gray-400",{"tab-act":d.value==="inactive"}]),onClick:s[2]||(s[2]=a=>d.value="inactive")},i(e.$t("staking.inactive")),3)]),t("div",Dt,i(r(E).length)+"/"+i(r(l).params.max_validators),1)]),t("div",At,[t("div",Tt,[t("table",Ft,[t("thead",Ot,[t("tr",null,[t("th",Jt,i(e.$t("staking.rank")),1),t("th",Rt,i(e.$t("staking.validator")),1),t("th",Gt,i(e.$t("staking.voting_power")),1),t("th",Ht,i(e.$t("staking.24h_changes")),1),t("th",Mt,i(e.$t("staking.commission")),1)])]),t("tbody",null,[(v(!0),g(ct,null,dt(r(E),({v:a,rank:c,logo:h},p)=>{var V,B,D,A;return v(),g("tr",{key:a.operator_address,class:"hover:bg-customDark dark:hover:bg-[#141414]"},[t("td",null,[t("div",{class:f(["text-xs truncate relative px-2 py-1 rounded-full w-fit",`text-${c}`])},[t("span",{class:f(["inset-x-0 inset-y-0 opacity-10 absolute",`bg-${c}`])},null,2),S(" "+i(p+1),1)],2)]),t("td",null,[t("div",Ut,[t("div",Wt,[qt,t("div",Kt,[h?(v(),g("img",{key:0,src:h,class:"object-contain",onError:$=>{var F;const T=(F=a.description)==null?void 0:F.identity;T&&X(T)}},null,40,Qt)):(v(),ut(r(k),{key:1,class:"text-3xl",icon:"mdi-help-circle-outline"}))])]),t("div",Xt,[t("span",Yt,[x(o,{to:{name:"chain-staking-validator",params:{validator:a.operator_address}},class:"font-weight-medium"},{default:ht(()=>{var $;return[S(i(($=a.description)==null?void 0:$.moniker),1)]}),_:2},1032,["to"])]),t("span",Zt,i(((V=a.description)==null?void 0:V.website)||((B=a.description)==null?void 0:B.identity)||"-"),1)])])]),t("td",te,[t("div",ee,[t("h6",se,i(r(u).formatToken({amount:parseInt(a.tokens).toString(),denom:r(l).params.bond_denom},!0,"0,0")),1),t("span",ae,i(r(u).calculatePercent(a.delegator_shares,r(l).totalPower)),1)])]),t("td",{class:f(["text-right text-xs",q(a)])},i(W(a)),3),t("td",oe,i(r(u).formatCommissionRate((A=(D=a.commission)==null?void 0:D.commission_rates)==null?void 0:A.rate)),1),t("td",ne,[a.jailed?(v(),g("div",ie,i(e.$t("staking.jailed")),1)):(v(),g("label",{key:1,for:"delegate",class:"btn btn-xs #sav1 rounded-sm capitalize",onClick:$=>r(R).open("delegate",{validator_address:a.operator_address})},i(e.$t("account.btn_delegate")),9,re))])])}),128))])])]),le,t("div",ce,[t("div",de,[ue,S(" "+i(e.$t("staking.top"))+" 33% ",1)]),t("div",he,[pe,S(" "+i(e.$t("staking.top"))+" 67% ",1)]),t("div",_e,i(e.$t("staking.description")),1)])])])])}}});typeof J=="function"&&J(ve);export{ve as default};
