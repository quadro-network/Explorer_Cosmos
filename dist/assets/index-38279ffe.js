import{d as V,o as i,c as r,F as B,g as L,b as t,n as g,E as O,J as U,k as W,j as q,a as u,l as E,y as J,cm as Y,bd as Q,r as X,t as a,e as F,p as Z,q as ee,S as te,f as _,m as $,z as k,a4 as se,Y as I}from"./index-61bbdb05.js";import{b as K}from"./route-block-83d24a4e.js";const oe={class:"flex gap-0.5"},ae=["data-tip"],ne=V({__name:"UptimeBar",props:{blocks:{type:Array}},setup(C){return(v,h)=>(i(),r("div",oe,[(i(!0),r(B,null,L(C.blocks,(c,p)=>(i(),r("div",{class:"cursor-default",key:p},[t("div",{class:g(["tooltip",c.color]),"data-tip":c.height,style:{width:"3px"}},"   ",10,ae)]))),128))]))}}),le={style:{display:"none"},class:"tabs tabs-boxed mb-4"},ie={class:"tab text-grey-100 capitalize"},re={class:"#saved px-5 pt-5"},ce={style:{display:"none"},class:"flex items-center gap-x-4"},de={key:0,class:"alert alert-warning my-4"},ue={class:"flex flex-row flex-wrap gap-x-4 mt-4 justify-center"},_e={class:"flex justify-between py-0 w-[248px]"},me={class:"truncate text-sm"},he={class:"ml-1 text-black dark:text-white"},pe={key:0,class:"badge badge-sm bg-transparent border-0 text-red-500 font-bold"},ge={key:1,class:"badge badge-sm bg-transparent text-customGreen border-0 font-bold"},be={class:"mt-5 flex bg-customDark border text-customGreen justify-center gap-2"},fe={class:"font-bold"},ke=t("span",{class:"bg-green-500"}," ",-1),ve=t("span",{class:"bg-yellow-500"}," ",-1),ye=t("span",{class:"bg-red-500"}," ",-1),xe={class:"table table-compact w-full mt-5"},we={class:"capitalize bg-customDark border text-customGreen"},$e={class:"text-right"},Ce={class:"text-right"},Se={class:"text-right"},Ne={class:"hover"},je={class:"truncate max-w-sm"},ze={class:"text-right"},Be=["data-tip"],Le={key:0},De=["data-tip"],Te={class:"text-xs text-right"},Ae={key:0,class:"text-right"},Pe={class:"text-right"},Re={class:"capitalize"},Ee={colspan:"2",class:"text-right"},Fe=["data-tip"],Ie={class:"ml-2 btn btn-error btn-xs"},Ke=t("td",{colspan:"8"},null,-1),Ve=t("div",{class:"h-6"},null,-1),Ge=V({__name:"index",props:["chain"],setup(C){const v=O(),h=U(),c=W(),p=q(),m=u(0),y=u(""),S=u(!0),x=u({}),D=u({});function G(s=[]){const o=Array(50).fill({height:"0",color:"bg-secondary"}).concat(s);return o.slice(o.length-50)}const N=E(()=>v.validators.map(s=>{const o=se(s.consensus_pubkey);return{moniker:s.description.moniker,hex:o,base64:I.toBase64(I.fromHex(o))}})),j=u({}),T=E(()=>{const s=y.value.length===0?N.value:N.value.filter(n=>n.moniker.toLowerCase().includes(y.value.toLowerCase())),o=Number(x.value.signed_blocks_window||0);return s.map(n=>{const e=D.value[n.hex],l=e&&o>0?(o-Number(e.missed_blocks_counter))/o:void 0;return{moniker:n.moniker,hex:n.hex,base64:n.base64,blocks:G(j.value[n.base64]||[]),uptime:l,missed_blocks_counter:e==null?void 0:e.missed_blocks_counter,signing:e}})}),A=u(!1);c.$subscribe((s,o)=>{var e,l,d;const n=Number(((d=(l=(e=o.latest)==null?void 0:e.block)==null?void 0:l.header)==null?void 0:d.height)||0);n>m.value&&(m.value=n,A.value||(M(),A.value=!0),Number(o.latest.block.header.height)%7===0&&P(),z(o.latest))}),J(()=>{var s;S.value=!0,(s=c.recents)==null||s.forEach(o=>{z(o,"start")}),P(),p.rpc.getSlashingParams().then(o=>{x.value=o.params})});function M(){if(m.value>50&&c.recents.length>=49)return;let s=Promise.resolve();for(let o=m.value-c.recents.length;o>m.value-50&&o>1;o-=1)s=s.then(()=>new Promise(n=>{S.value&&o>m.value-50&&c.fetchBlock(o).then(e=>{z(e,"start"),n()})}))}function z(s,o="end"){N.value.forEach(n=>{var f;const e=(f=s.block.last_commit)==null?void 0:f.signatures.find(w=>w.validator_address===n.base64),l=j.value[n.base64]||[];let d={height:s.block.header.height,color:"bg-red-500"};e&&(d={height:s.block.header.height,color:e.block_id_flag==="BLOCK_ID_FLAG_COMMIT"?"bg-green-500":"bg-yellow-500"}),o==="end"?l.push(d):l.unshift(d),l.length>50&&l.shift(),j.value[n.base64]=l})}function P(){p.rpc.getSlashingSigningInfos().then(s=>{var o;(o=s.info)==null||o.forEach(n=>{D.value[Y(n.address)]=n})})}Q(()=>{S.value=!1});const b=u("3");function R(s){b.value=s}function H(){var s,o,n;v.fetchAllKeyRotation((n=(o=(s=c.latest)==null?void 0:s.block)==null?void 0:o.header)==null?void 0:n.chain_id)}return(s,o)=>{const n=X("RouterLink");return i(),r("div",null,[t("div",le,[t("a",{class:g(["tab text-grey-100 capitalize",{"tab-active":b.value==="3"}]),onClick:o[0]||(o[0]=e=>R("3"))},a(s.$t("uptime.overall")),3),t("a",{class:g(["tab text-grey-100 capitalize",{"tab-active":b.value==="2"}]),onClick:o[1]||(o[1]=e=>R("2"))},a(s.$t("module.blocks")),3),F(n,{to:`/${C.chain}/uptime/customize`},{default:Z(()=>[t("a",ie,a(s.$t("uptime.customize")),1)]),_:1},8,["to"])]),t("div",re,[t("div",ce,[ee(t("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=e=>y.value=e),placeholder:"Keywords to filter validators",class:"input input-sm w-full flex-1 border border-grey-200 dark:border-grey-600"},null,512),[[te,y.value]]),_(p).isConsumerChain?(i(),r("button",{key:0,class:"btn btn-sm btn-primary",onClick:H},"Load Rotated Keys")):$("",!0)]),_(p).isConsumerChain&&Object.keys(_(v).keyRotation).length===0?(i(),r("div",de," Note: Please load rotated keys to see the correct uptime ")):$("",!0),t("div",{class:g(b.value==="2"?"":"hidden")},[t("div",ue,[(i(!0),r(B,null,L(T.value,(e,l)=>(i(),r("div",{key:l},[t("div",_e,[t("label",me,[t("span",he,a(l+1)+"."+a(e.moniker),1)]),Number((e==null?void 0:e.missed_blocks_counter)||0)>10?(i(),r("div",pe,a(e==null?void 0:e.missed_blocks_counter),1)):(i(),r("div",ge,a(e==null?void 0:e.missed_blocks_counter),1))]),F(ne,{blocks:e.blocks},null,8,["blocks"])]))),128))]),t("div",be,[t("span",fe,a(s.$t("uptime.legend"))+": ",1),ke,k(" "+a(s.$t("uptime.committed"))+" ",1),ve,k(" "+a(s.$t("uptime.precommitted"))+" ",1),ye,k(" "+a(s.$t("uptime.missed")),1)])],2),t("div",{class:g([b.value==="3"?"":"hidden","overflow-x-auto"])},[t("table",xe,[t("thead",we,[t("tr",null,[t("td",null,a(s.$t("account.validator")),1),t("td",$e,a(s.$t("module.uptime")),1),t("td",null,a(s.$t("uptime.last_jailed_time")),1),t("td",Ce,a(s.$t("uptime.signed_precommits")),1),t("td",Se,a(s.$t("uptime.start_height")),1),t("td",null,a(s.$t("uptime.tombstoned")),1)])]),(i(!0),r(B,null,L(T.value,(e,l)=>{var d,f,w;return i(),r("tr",Ne,[t("td",null,[t("div",je,a(l+1)+". "+a(e.moniker),1)]),t("td",ze,[t("span",{class:g(e.uptime&&e.uptime>.95?"text-grey-50":"text-red-500")},[t("div",{class:"tooltip","data-tip":`${e.missed_blocks_counter} missing blocks`},a(_(h).percent(e.uptime)),9,Be)],2)]),t("td",null,[e.signing&&!e.signing.jailed_until.startsWith("1970")?(i(),r("span",Le,[t("div",{class:"tooltip","data-tip":_(h).toDay(e.signing.jailed_until,"long")},[t("span",null,a(_(h).toDay(e.signing.jailed_until,"from")),1)],8,De)])):$("",!0)]),t("td",Te,[e.signing&&e.signing.jailed_until.startsWith("1970")?(i(),r("span",Ae,a(_(h).percent(Number(e.signing.index_offset)/(m.value-Number(e.signing.start_height)))),1)):$("",!0),k(" "+a((d=e.signing)==null?void 0:d.index_offset),1)]),t("td",Pe,a((f=e.signing)==null?void 0:f.start_height),1),t("td",Re,a((w=e.signing)==null?void 0:w.tombstoned),1)])}),256)),t("tfoot",null,[t("tr",null,[t("td",Ee,[k(a(s.$t("uptime.minimum_uptime"))+": ",1),t("span",{class:"lowercase tooltip","data-tip":`Window size: ${x.value.signed_blocks_window}`},[t("span",Ie,a(_(h).percent(x.value.min_signed_per_window)),1)],8,Fe)]),Ke])])])],2),Ve])])}}});typeof K=="function"&&K(Ge);export{Ge as default};
