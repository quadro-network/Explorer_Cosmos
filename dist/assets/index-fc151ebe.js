import{d as Z,G as tt,l as et,K as st,Q as at,k as ot,J as nt,b as _,U as it,M as D,r as rt,o as v,c as m,e as t,f as x,g as r,I as y,t as i,c6 as lt,n as f,F as ct,i as dt,A as S,x as ut,q as ht}from"./index-bc232f19.js";import{b as J}from"./route-block-83d24a4e.js";const pt={class:"#saved rounded-lg grid sm:grid-cols-1 md:grid-cols-4 p-4"},_t={class:"flex"},vt={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},gt=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-gray-950"},null,-1),mt={class:"font-bold"},ft={class:"text-xs"},bt={class:"flex"},xt={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},yt=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 #sav1"},null,-1),kt={class:"font-bold"},wt={class:"text-xs"},$t={class:"flex"},St={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},Ct=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-error"},null,-1),Nt={class:"font-bold"},It={class:"text-xs"},jt={class:"flex"},zt={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},Vt=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-error"},null,-1),At={class:"font-bold"},Bt={class:"text-xs"},Et={class:"flex items-center justify-between py-1"},Lt={class:"tabs tabs-boxed bg-transparent"},Pt={class:"text-lg font-semibold"},Tt={class:"#saved px-4 pt-3 pb-4 rounded shadow"},Ft={class:"overflow-x-auto"},Ot={class:"table staking-table w-full"},Dt={class:"bg-gray-950"},Jt={scope:"col",class:"uppercase",style:{width:"3rem",position:"relative"}},Rt={scope:"col",class:"uppercase"},Mt={scope:"col",class:"text-right uppercase"},Ut={scope:"col",class:"text-right uppercase"},qt={scope:"col",class:"text-right uppercase"},Gt={class:"flex items-center overflow-hidden",style:{"max-width":"300px"}},Ht={class:"avatar mr-4 relative w-8 h-8 rounded-full"},Kt=t("div",{class:"w-8 h-8 rounded-full bg-gray-400 absolute opacity-10"},null,-1),Qt={class:"w-8 h-8 rounded-full"},Wt=["src","onError"],Xt={class:"flex flex-col"},Yt={class:"text-sm #saved whitespace-nowrap overflow-hidden"},Zt={class:"text-xs"},te={class:"text-right"},ee={class:"flex flex-col"},se={class:"text-sm font-weight-medium whitespace-nowrap"},ae={class:"text-xs"},oe={class:"text-right text-xs"},ne={style:{display:"none"},class:"text-center"},ie={key:0,class:"badge badge-error gap-2 text-white"},re=["onClick"],le=t("div",{class:"divider"},null,-1),ce={class:"flex flex-row items-center"},de={class:"text-xs truncate relative py-2 px-4 rounded-md w-fit text-error mr-2"},ue=t("span",{class:"inset-x-0 inset-y-0 opacity-10 absolute bg-error"},null,-1),he={class:"text-xs truncate relative py-2 px-4 rounded-md w-fit text-warning"},pe=t("span",{class:"inset-x-0 inset-y-0 opacity-10 absolute bg-warning"},null,-1),_e={class:"text-xs hidden md:!block pl-2"},ve=Z({__name:"index",setup(ge){const l=tt(),k=et(),u=st(),R=at(),I=ot(),M=nt(),U=JSON.parse(localStorage.getItem("avatars")||"{}"),g=_(U||{}),w=_({}),j=_({}),d=_("active"),b=_([]),C=_({});it(()=>{l.fetchUnbondingValdiators().then(e=>{b.value=e.concat(b.value)}),l.fetchInacitveValdiators().then(e=>{b.value=b.value.concat(e)}),I.rpc.getSlashingParams().then(e=>{C.value=e.params})});async function q(e=14400){var n,a,c;let s=0,o=Number(((c=(a=(n=k.latest)==null?void 0:n.block)==null?void 0:a.header)==null?void 0:c.height)||0);for(o>e?o-=e:o=1;s<l.validators.length&&o>0;)await k.fetchValidatorByHeight(o,s).then(h=>{h.validators.forEach(p=>{j.value[p.pub_key.key]=Number(p.voting_power)})}),s+=100;for(s=0;s<l.validators.length;)await k.fetchLatestValidators(s).then(h=>{h.validators.forEach(p=>{w.value[p.pub_key.key]=Number(p.voting_power)})}),s+=100}const G=D(()=>{const e={};return Object.keys(w.value).forEach(s=>{const o=w.value[s]||0,n=j.value[s]||0;e[s]=o-n}),e}),z=e=>{const s=e.consensus_pubkey.key,o=w.value[s];if(!o)return 0;const a=u.tokenAmountNumber({amount:parseInt(e.tokens,10).toString(),denom:l.params.bond_denom})/o;return G.value[s]*a},H=e=>{if(!e)return"";const s=z(e);return s&&s!==0?u.showChanges(s):""},K=e=>{if(!e)return"";const s=z(e);if(s>0)return"text-base-content";if(s<0)return"text-error"},Q=function(e){var n;let s=0;for(let a=0;a<e;a++)s+=Number((n=l.validators[a])==null?void 0:n.delegator_shares);const o=s/l.totalPower;switch(!0){case(d.value==="active"&&o<.33):return"error";case(d.value==="active"&&o<.67):return"warning";default:return"primary"}};function W(e,s){return!e||!s?!1:e.findIndex(o=>{var n,a,c;return s.website&&((a=s.website)==null?void 0:a.substring(0,(n=s.website)==null?void 0:n.lastIndexOf(".")).endsWith(o))||((c=s==null?void 0:s.moniker)==null?void 0:c.toLowerCase().search(o.toLowerCase()))>-1})>-1}const V=D(()=>{var e,s,o;if(d.value==="active")return l.validators.map((n,a)=>({v:n,rank:Q(a),logo:N(n.description.identity)}));if(d.value==="featured"){const n=(o=(s=(e=I.current)==null?void 0:e.endpoints)==null?void 0:s.rest)==null?void 0:o.map(a=>a.provider);return n?(n.push("ping"),l.validators.filter(a=>W(n,a.description)).map((a,c)=>({v:a,rank:"primary",logo:N(a.description.identity)}))):[]}return b.value.map((n,a)=>({v:n,rank:"primary",logo:N(n.description.identity)}))}),A=e=>new Promise(s=>{l.keybase(e).then(o=>{var n,a,c;if(Array.isArray(o.them)&&o.them.length>0){const h=String((c=(a=(n=o.them[0])==null?void 0:n.pictures)==null?void 0:a.primary)==null?void 0:c.url).replace("https://s3.amazonaws.com/keybase_processed_uploads/","");g.value[e]=h,s()}else throw new Error(`failed to fetch avatar for ${e}`)}).catch(o=>{s()})}),X=e=>{A(e).then(()=>{localStorage.setItem("avatars",JSON.stringify(g.value))})},Y=()=>{const e=l.validators.map(s=>{var n;const o=(n=s.description)==null?void 0:n.identity;return o&&!g.value[o]?A(o):Promise.resolve()});Promise.all(e).then(()=>localStorage.setItem("avatars",JSON.stringify(g.value)))},N=e=>{if(!e||!g.value[e])return"";const s=g.value[e]||"";return s.startsWith("http")?s:`https://s3.amazonaws.com/keybase_processed_uploads/${s}`},B=_(!1);return k.$subscribe((e,s)=>{if(s.recents.length>=2&&B.value===!1){B.value=!0;const o=Date.parse(s.recents[1].block.header.time)-Date.parse(s.recents[0].block.header.time),n=Number(s.recents[1].block.header.height)-Number(s.recents[0].block.header.height),a=Number(Number(86400*1e3*n/o).toFixed(0));q(a)}}),Y(),(e,s)=>{var n;const o=rt("RouterLink");return v(),m("div",null,[t("div",pt,[t("div",_t,[t("span",null,[t("div",vt,[x(r(y),{class:"text-base-content",icon:"mdi:trending-up",size:"32"}),gt])]),t("span",null,[t("div",mt,i(r(u).percent(r(M).inflation)),1),t("div",ft,i(e.$t("staking.inflation")),1)])]),t("div",bt,[t("span",null,[t("div",xt,[x(r(y),{class:"#saved",icon:"mdi:lock-open-outline",size:"32"}),yt])]),t("span",null,[t("div",kt,i(r(lt)((n=r(l).params)==null?void 0:n.unbonding_time)),1),t("div",wt,i(e.$t("staking.unbonding_time")),1)])]),t("div",$t,[t("span",null,[t("div",St,[x(r(y),{class:"text-error",icon:"mdi:alert-octagon-outline",size:"32"}),Ct])]),t("span",null,[t("div",Nt,i(r(u).percent(C.value.slash_fraction_double_sign)),1),t("div",It,i(e.$t("staking.double_sign_slashing")),1)])]),t("div",jt,[t("span",null,[t("div",zt,[x(r(y),{class:"text-error",icon:"mdi:pause",size:"32"}),Vt])]),t("span",null,[t("div",At,i(r(u).percent(C.value.slash_fraction_downtime)),1),t("div",Bt,i(e.$t("staking.downtime_slashing")),1)])])]),t("div",null,[t("div",Et,[t("div",Lt,[t("a",{class:f(["tab text-gray-400",{"tab-act":d.value==="featured"}]),onClick:s[0]||(s[0]=a=>d.value="featured")},i(e.$t("staking.popular")),3),t("a",{class:f(["tab text-gray-400",{"tab-act":d.value==="active"}]),onClick:s[1]||(s[1]=a=>d.value="active")},i(e.$t("staking.active")),3),t("a",{class:f(["tab text-gray-400",{"tab-act":d.value==="inactive"}]),onClick:s[2]||(s[2]=a=>d.value="inactive")},i(e.$t("staking.inactive")),3)]),t("div",Pt,i(r(V).length)+"/"+i(r(l).params.max_validators),1)]),t("div",Tt,[t("div",Ft,[t("table",Ot,[t("thead",Dt,[t("tr",null,[t("th",Jt,i(e.$t("staking.rank")),1),t("th",Rt,i(e.$t("staking.validator")),1),t("th",Mt,i(e.$t("staking.voting_power")),1),t("th",Ut,i(e.$t("staking.24h_changes")),1),t("th",qt,i(e.$t("staking.commission")),1)])]),t("tbody",null,[(v(!0),m(ct,null,dt(r(V),({v:a,rank:c,logo:h},p)=>{var E,L,P,T;return v(),m("tr",{key:a.operator_address,class:"hover:bg-gray-100 dark:hover:bg-[#141414]"},[t("td",null,[t("div",{class:f(["text-xs truncate relative px-2 py-1 rounded-full w-fit",`text-${c}`])},[t("span",{class:f(["inset-x-0 inset-y-0 opacity-10 absolute",`bg-${c}`])},null,2),S(" "+i(p+1),1)],2)]),t("td",null,[t("div",Gt,[t("div",Ht,[Kt,t("div",Qt,[h?(v(),m("img",{key:0,src:h,class:"object-contain",onError:$=>{var O;const F=(O=a.description)==null?void 0:O.identity;F&&X(F)}},null,40,Wt)):(v(),ut(r(y),{key:1,class:"text-3xl",icon:"mdi-help-circle-outline"}))])]),t("div",Xt,[t("span",Yt,[x(o,{to:{name:"chain-staking-validator",params:{validator:a.operator_address}},class:"font-weight-medium"},{default:ht(()=>{var $;return[S(i(($=a.description)==null?void 0:$.moniker),1)]}),_:2},1032,["to"])]),t("span",Zt,i(((E=a.description)==null?void 0:E.website)||((L=a.description)==null?void 0:L.identity)||"-"),1)])])]),t("td",te,[t("div",ee,[t("h6",se,i(r(u).formatToken({amount:parseInt(a.tokens).toString(),denom:r(l).params.bond_denom},!0,"0,0")),1),t("span",ae,i(r(u).calculatePercent(a.delegator_shares,r(l).totalPower)),1)])]),t("td",{class:f(["text-right text-xs",K(a)])},i(H(a)),3),t("td",oe,i(r(u).formatCommissionRate((T=(P=a.commission)==null?void 0:P.commission_rates)==null?void 0:T.rate)),1),t("td",ne,[a.jailed?(v(),m("div",ie,i(e.$t("staking.jailed")),1)):(v(),m("label",{key:1,for:"delegate",class:"btn btn-xs #sav1 rounded-sm capitalize",onClick:$=>r(R).open("delegate",{validator_address:a.operator_address})},i(e.$t("account.btn_delegate")),9,re))])])}),128))])])]),le,t("div",ce,[t("div",de,[ue,S(" "+i(e.$t("staking.top"))+" 33% ",1)]),t("div",he,[pe,S(" "+i(e.$t("staking.top"))+" 67% ",1)]),t("div",_e,i(e.$t("staking.description")),1)])])])])}}});typeof J=="function"&&J(ve);export{ve as default};
